<!DOCTYPE html>
<html lang="en">
    <head>
        <title>VKGeo</title>

        <meta charset="UTF-8">

        <link rel="stylesheet" href="https://openlayers.org/en/v4.6.5/css/ol.css" type="text/css">
        <link rel="stylesheet" href="style.css">

        <script src="https://openlayers.org/en/v4.6.5/build/ol.js"></script>
        <script src="https://www.localeplanet.com/api/auto/icu.js"></script>
        <script src="https://www.localeplanet.com/api/translate.js"></script>
        <script src="https://vk.com/js/api/xd_connection.js?2"></script>
    </head>
    <body>
        <div id="map"></div>
        <div id="controlPanel"></div>
        <div id="invitationPanel">
            <p id="invitationPanelText"></p>
            <button id="invitationPanelGetIosButton" onClick="window.open(&quot;https://itunes.apple.com/app/id1381218973&quot;)"></button>
        </div>
        <div id="settingsPanel">
            <p id="settingsPanelText"></p>
            <button id="settingsPanelButton" onClick="requestSettings()"></button>
        </div>
        <div id="fatalErrorPanel">
            <p id="fatalErrorPanelText"></p>
        </div>

        <script>
            function escapeHtml(string) {
                var text = document.createTextNode(string);
                var div  = document.createElement("div");

                div.appendChild(text);

                return div.innerHTML;
            }

            function getUrlParameter(name) {
                name = name.replace(/[\[\]]/g, "\\$&");

                var regex   = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)");
                var results = regex.exec(window.location.href);

                if (results) {
                    if (results[2]) {
                        return decodeURIComponent(results[2].replace(/\+/g, " "));
                    } else {
                        return "";
                    }
                } else {
                    return null;
                }
            }

            function displayFatalError(error_text) {
                document.getElementById("fatalErrorPanelText").innerHTML = escapeHtml(error_text);

                document.getElementById("fatalErrorPanel").style.display = "flex";
            }

            try {
                eval("const c = 1; let v = (x) => x + c; let l = (new URL(document.location)).searchParams.get(\"language\");");

                document.addEventListener("DOMContentLoaded", function() {
                    var script = document.createElement("script");

                    script.src   = "vkgeo.js";
                    script.async = true;

                    document.getElementsByTagName("head")[0].appendChild(script);
                });
            } catch (err) {
                displayFatalError(_("Please update your browser to start using this app."));
            }
        </script>
    </body>
</html>
